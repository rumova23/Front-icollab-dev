<div class="row">
	<mdb-breadcrumb customClass="white" class="w-100">
		<mdb-breadcrumb-item class="">
			<mdb-icon fas icon="cog"></mdb-icon>
		</mdb-breadcrumb-item>
		<mdb-breadcrumb-item>{{ " Cumplimiento Legal " | translate }}</mdb-breadcrumb-item>
		<mdb-breadcrumb-item class="active">{{ " Aprobación de Cumplimiento" | translate }}</mdb-breadcrumb-item>
	</mdb-breadcrumb>
</div>

<div class="section">
	<div class="row">
		<div class="col">
			<p class="section_titulo_0">{{ " Aprobación de Cumplimiento / Generación de Tareas " | translate }}</p>
			<p class="section_subtitulo_0">{{ "Buscar por" | translate }}</p>
		</div>
	</div>
	<hr>
	<!---->
	<form [formGroup]="filtrosForm">
		<div class="row" *ngIf="isSupervisor">
			<div class="form-group col-12 col-md-6 col-lg-4">
				<label>Año</label>
				<app-mat-input-datepicker-year
					[formGroup]="filtrosForm"
					controlName="fAnio"
					(eventChange)="eventChangeAnio($event)">
				</app-mat-input-datepicker-year>
			</div>
			<div class="form-group col-12 col-md-6 col-lg-4">
				<table matSort mat-table [dataSource]="administradores" class="table_catalogo">
					<ng-container matColumnDef="order">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="txt-center">#</th>
						<td mat-cell *matCellDef="let element; let i = index" class="p-2 border-none">
							{{ i + 1 }}
						</td>
					</ng-container>
					<ng-container matColumnDef="admin" sticky>
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="txt-center">Administrador</th>
						<td mat-cell *matCellDef="let element">{{ element.username }}</td>
					</ng-container>
					<ng-container matColumnDef="responsabilidad">
						<th mat-header-cell *matHeaderCellDef mat-sort-header class="txt-center">Aprobada</th>
						<td mat-cell *matCellDef="let element">
							<i class="material-icons">
								{{ element.estatusResponsabilidad === 2960 ? "check" : "close" }}
							</i>
						</td>
					</ng-container>
					<tr mat-header-row *matHeaderRowDef="columnasResponsabilidad"></tr>
					<tr mat-row *matRowDef="let row; columns: columnasResponsabilidad"></tr>
				</table>
			</div>
		</div>
		<div class="row">
			<div class="form-group col-12 col-md-6 col-lg-4">
				<label>Tipo Cumplimiento</label>
				<select class="form-control" formControlName="fTipoCumplimiento">
					<option></option>
					<option *ngFor="let operator of tiposCumplimientos;" [value]="operator.value">
						{{operator.label}}
					</option>
				</select>
			</div>
			<div class="form-group col-12 col-md-6 col-lg-4">
				<label>Actividad</label>
				<select class="form-control" formControlName="fActividad">
					<option></option>
					<option *ngFor="let operator of actividades;" [value]="operator.value">
						{{operator.label}}
					</option>
				</select>
			</div>

		</div>
	</form>
	<br>
	<hr>
	<br>
	<!---->

	<form [formGroup]="formFiltersTable" (ngSubmit)="onFiltersTable()">

		<div class="row mt-3">
			<div class="col-12 col-lg-4">
				<app-mat-input-text-autocomplete
					[formGroup]="formFiltersTable"
					controlName="tag"
					[options]="filteredAutoTag"
					(keyUpChange)="keyUpTag($event)"
					label="Tag"></app-mat-input-text-autocomplete>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-input-text-autocomplete
					[formGroup]="formFiltersTable"
					controlName="nombre"
					[options]="filteredAutoName"
					(keyUpChange)="keyUpComplianceName($event)"
					label="Nombre del Cumplimiento"></app-mat-input-text-autocomplete>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-select [formGroup]="formFiltersTable" controlName="clasificacion"
					[options]="optionsClasificacion" label="Categoría"></app-mat-select>
			</div>
		</div>

		<div class="row">
			<div class="col col-lg-4">
				<div class="row">
					<div class="col">
						<label>Período de entrega</label>
					</div>
				</div>
				<div class="row">
					<div class="col-12 col-lg-4">
						<app-mat-input-number [formGroup]="formFiltersTable" controlName="periodo_entrega_cantidad"
							(eventChange)="isnumeric($event)">
						</app-mat-input-number>
					</div>

					<div class="col-12 col-lg-8">
						<app-mat-select [formGroup]="formFiltersTable" controlName="periodo_entrega_unidad"
							[options]="optionsPeriod">
						</app-mat-select>
					</div>
				</div>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-select [formGroup]="formFiltersTable" controlName="autoridad" [options]="comboAutoridad"
					label="Autoridad"></app-mat-select>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-select [formGroup]="formFiltersTable" controlName="tipo_aplicacion"
					[options]="comboTipoAplicacion" label="Tipo de Aplicación"></app-mat-select>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-select [formGroup]="formFiltersTable" controlName="grupo" [options]="comboGrupo" label="Grupo">
				</app-mat-select>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-select [formGroup]="formFiltersTable" controlName="estatus" [options]="comboEstatus"
					label="Estatus"></app-mat-select>
			</div>
			<div class="col-12 col-lg-4">
				<app-mat-input-text-autocomplete
					[formGroup]="formFiltersTable"
					controlName="userUpdated"
					[options]="filteredUserUpdated"
					(keyUpChange)="keyUpUserUpdate($event)"
					label="Usuario Modifico"></app-mat-input-text-autocomplete>
			</div>
		</div>

		<div class="row">
			<div class="col-12 col-lg-4">
				<label>Fecha de Última Modificación</label><br>
				<app-mat-input-datepicker
					[formGroup]="formFiltersTable"
					controlName="minDate__dateUpdated"
					label="De"
					(eventChange)="onChangeDateIniFechaFin($event)">
				</app-mat-input-datepicker>
			</div>
			<div class="col-12 col-lg-4">
				<label style="visibility: hidden;">.</label><br>
				<app-mat-input-datepicker
					[formGroup]="formFiltersTable"
					controlName="maxDate__dateUpdated"
					label="Al"
					[minDate]="initDate">
				</app-mat-input-datepicker>
			</div>
		</div>
		<div class="row">
			<div class="col">
				<app-mat-radio-button [formGroup]="formFiltersType" controlName="typeFilter"
					[options]="optionsFiltersType"></app-mat-radio-button>
			</div>
		</div>

		<div class="row justify-content-end">
			<div class="col-12 col-lg-2">
				<app-btn-block-search myType="submit"></app-btn-block-search>
			</div>
			<div class="col-12 col-lg-2">
				<app-btn-block-clean (myClick)="limpiarFiltros()"></app-btn-block-clean>
			</div>
		</div>
	</form>

	<div class="row">
		<div class="col-12 col-lg-4">
		</div>
		<div class="col-12 col-lg-2">
			<app-btn-block [disabled]="selectYear < currentYear+1" label="Aprobar" (myClick)="aprobarMatrizCumplimiento()"></app-btn-block>
		</div>
		<div class="col-12 col-lg-2">
			<app-btn-block [disabled]="selectYear < currentYear+1" label="Rechazar" (myClick)="rechazarMatrizCumplimiento()"></app-btn-block>
		</div>
		<div class="col-12 col-lg-2">
			<app-btn-block [disabled]="approved == null" label="Generar Tareas" (myClick)="generarTareas()"></app-btn-block>
		</div>
	</div>

	<div class="row justify-content-between mt-5">
		<div class="col-12 col-lg-4">
			<p class="section_titulo_0">
				<span *ngIf="approved != null"> Estatus: {{approved}}</span>
			</p>
		</div>
		<div class="col-12 col-lg-2">
			<app-btn-block label="Seguimiento" (myClick)="SeguimientoAprovaciones()"></app-btn-block>
		</div>
	</div>
	<div class="row my-4">
		<div class="col">
			<app-mat-table [data]="tableData" [columnsLabels]="tablaColumnsLabels"
				[columnsDisplay]="tableColumnsDisplay" [row_x_page]="tableRowXpage"
				 (clickSee)="onTableRowSee($event)"></app-mat-table>
		</div>
	</div>

	<div *ngIf="showTrack" class="row my-4">
		<div class="col">
			<app-mat-table
					[data]="tracks"
					[columnsDisplay]="tracksColumnsDisplay"
					[columnsLabels]="trackColumnsLabels"
				></app-mat-table>
		</div>
	</div>
</div>