<div id="agrupar">
    <!-- Header -->
    <app-complianceHeader></app-complianceHeader>
    <!-- /Header -->
    <div id="body">
        <!-- Aside -->
        <aside id="columna" [ngStyle]="{'width':aside_open ? '250px' : '60px' }" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">
            <div class="container-fluid">
                <div class="row">
                    <div class="col mt-2 mr-1 mb-3" style="text-align: right;">
                        <span (click)="aside_open=!aside_open" >
                            <mdb-icon fas icon="bars" style="font-size: 30px;"></mdb-icon>
                        </span>
                    </div>
                </div>
                <app-complianceSidebar [aside_open]='aside_open'></app-complianceSidebar>
            </div>
        </aside>
        <!-- /Aside -->

        <section id="seccion" [ngStyle]="{'width':aside_open ? 'calc(100% - 250px)' : 'calc(100% - 60px)' }">
            <div class="container-fluid">
            <!--  CUERPO DEL COMPONENTE -->

                

                  <div class="row">
                    <div class="col">
                        <h1 class="mt-3">{{titulo}}</h1>
                        <form class="mt-5" [formGroup]="configActividadesForm" (ngSubmit)="onSubmit()">
                          <div class="row">
                            <!-- Grid column -->
                            <div class="col-md-4" style="display: none;">
                              <!-- Material input -->
                              <div class="md-form">
                                  <mat-form-field class="w-100">
                                    <input matInput placeholder="Id Tag" formControlName="fIdTag" readonly="true" >
                                  </mat-form-field>
                              </div>
                            </div>
                
                            <div class="col-md-4">
                              <!-- Material input -->
                              <div class="md-form">
                                <mat-form-field class="w-100">
                                  <input matInput placeholder="Tag" formControlName="fTag" readonly="true" [ngClass]="{ 'is-invalid': submitted && f.fTag.errors }">
                                  <div *ngIf="submitted && f.fTag.errors" style="color:red">
                                      <div *ngIf="f.fTag.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                            <div class="col-md-4" *ngIf="false">
                              <!-- Material input -->
                              <div class="md-form">
                                  <button type="button" class="btn" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}" (click)="obtenerActividad()" >Buscar</button>
                                  <button type="button" class="btn" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}" (click)="limpiarFormulario()" > Nuevo </button>
                              </div>
                            </div>
                          </div>
                
                          <div class="row">
                            <div class="col-md-12">
                              <div class="md-form">
                                <mat-form-field class="w-100">
                                  <input matInput placeholder="Descripción" formControlName="fDescripcion" [readonly]="soloLectura" [ngClass]="{ 'is-invalid': submitted && f.fDescripcion.errors }">
                                  <div *ngIf="submitted && f.fDescripcion.errors" style="color:red">
                                      <div *ngIf="f.fDescripcion.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>
                
                          <div class="row">
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <mat-label>Categoría</mat-label>
                                  <mat-select formControlName="fActividad"
                                              [compareWith]="compareFn" 
                                              (selectionChange)="asignarNombreTag($event.value)" 
                                              [disabled]="habilitarActividad" 
                                              [ngClass]="{ 'is-invalid': submitted && f.fActividad.errors }">
                                      <mat-option *ngFor="let operator of comboActividades;" [value]="operator.value">{{operator.label}}</mat-option>
                                  </mat-select>
                                  <div *ngIf="submitted && f.fActividad.errors" style="color:red">
                                    <div *ngIf="f.fActividad.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <input matInput placeholder="Nombre del Cumplimiento" formControlName="fClasificacionActividad" [readonly]="soloLectura" [ngClass]="{ 'is-invalid': submitted && f.fClasificacionActividad.errors }">
                                  <div *ngIf="submitted && f.fClasificacionActividad.errors" style="color:red">
                                      <div *ngIf="f.fClasificacionActividad.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>
                
                          <div class="row">
                              <div class="col-md-6">
                                <div class="md-form form-group">
                                  <mat-form-field class="w-100">
                                    <mat-label>Tipo de Cumplimiento</mat-label>
                                    <mat-select formControlName="fTipoCumplimiento" 
                                                [disabled]="soloLectura" 
                                                [compareWith]="compareFn"
                                                [ngClass]="{ 'is-invalid': submitted && f.fTipoCumplimiento.errors }">
                                      <mat-option 
                                                *ngFor="let operator of comboTipoCumplimiento;" 
                                                [value]="operator.value">{{operator.label}}</mat-option>
                                    </mat-select>
                                    <div *ngIf="submitted && f.fTipoCumplimiento.errors" style="color:red">
                                      <div *ngIf="f.fTipoCumplimiento.errors.required">Requerido</div>
                                    </div>
                                  </mat-form-field>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="md-form">
                                  <mat-form-field class="w-100">
                                    <input matInput placeholder="Requisito Legal" formControlName="fRequisitoLegal" [readonly]="soloLectura" [ngClass]="{ 'is-invalid': submitted && f.fRequisitoLegal.errors }">
                                    <div *ngIf="submitted && f.fRequisitoLegal.errors" style="color:red">
                                        <div *ngIf="f.fRequisitoLegal.errors.required">Requerido</div>
                                    </div>
                                  </mat-form-field>
                                </div>
                              </div>
                          </div>
                
                          <div class="row">
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <mat-label>Autoridad</mat-label>
                                  <mat-select [compareWith]="compareFn" 
                                              formControlName="fAutoridad"
                                              [disabled]="soloLectura" 
                                              [ngClass]="{ 'is-invalid': submitted && f.fAutoridad.errors }">
                                      <mat-option *ngFor="let operator of comboAutoridad;" [value]="operator.value">{{operator.label}}</mat-option>
                                  </mat-select>
                                  <div *ngIf="submitted && f.fAutoridad.errors" style="color:red">
                                    <div *ngIf="f.fAutoridad.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <mat-label>Tipo de Aplicación</mat-label>
                                  <mat-select [compareWith]="compareFn" 
                                              formControlName="fTipoAplicacion" 
                                              [disabled]="soloLectura"
                                              [ngClass]="{ 'is-invalid': submitted && f.fTipoAplicacion.errors }">
                                      <mat-option *ngFor="let operator of comboTipoAplicacion;" [value]="operator.value">{{operator.label}}</mat-option>
                                  </mat-select>
                                  <div *ngIf="submitted && f.fTipoAplicacion.errors" style="color:red">
                                    <div *ngIf="f.fTipoAplicacion.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>
                
                          <div class="row">
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <mat-label>Período de entrega</mat-label>
                                  <mat-select [compareWith]="compareFn" 
                                              formControlName="fPeriodoEntrega" 
                                              [disabled]="soloLectura"
                                              [ngClass]="{ 'is-invalid': submitted && f.fPeriodoEntrega.errors }">
                                      <mat-option *ngFor="let operator of comboPeriodoEntrega;" [value]="operator.value">{{operator.label}}</mat-option>
                                  </mat-select>
                                  <div *ngIf="submitted && f.fPeriodoEntrega.errors" style="color:red">
                                    <div *ngIf="f.fPeriodoEntrega.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <mat-label>Tipo de días</mat-label>
                                  <mat-select [compareWith]="compareFn" 
                                              formControlName="fTipoDias" 
                                              [disabled]="soloLectura"
                                              [ngClass]="{ 'is-invalid': submitted && f.fTipoDias.errors }">
                                      <mat-option *ngFor="let operator of comboTipoDias;" [value]="operator.value">{{operator.label}}</mat-option>
                                  </mat-select>
                                  <div *ngIf="submitted && f.fTipoDias.errors" style="color:red">
                                    <div *ngIf="f.fTipoDias.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>
                      
                          <div class="row">
                            <div class="col-md-12">
                              <div class="md-form">
                                <mat-form-field class="w-100">
                                    <mat-label>Planta</mat-label>
                                    <mat-select [multiple] = "true" (click)="onClickPlanta()"
                                                [disabled]="soloLectura" 
                                                [compareWith]="compareFn" 
                                                formControlName="fPlanta" 
                                                [ngClass]="{ 'is-invalid': submitted && f.fPlanta.errors }">
                                      <mat-option *ngFor="let operator of comboPlanta" 
                                              [disabled]="operator.value == plantaDefault"
                                              [value]="operator.value">{{operator.label}}</mat-option>
                                    </mat-select>
                                    <div *ngIf="submitted && f.fPlanta.errors" style="color:red">
                                      <div *ngIf="f.fPlanta.errors.required">Requerido</div>
                                    </div>
                                  </mat-form-field>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-6">
                              <div class="md-form form-group">
                                <mat-form-field class="w-100">
                                  <mat-label>Estatus</mat-label>
                                  <mat-select [compareWith]="compareFn" 
                                              formControlName="fComboEstatus" 
                                              [disabled]="deshabiliarEstatus"
                                              [ngClass]="{ 'is-invalid': submitted && f.fComboEstatus.errors }">
                                      <mat-option *ngFor="let operator of comboEstatus;" [value]="operator.value">{{operator.label}}</mat-option>
                                  </mat-select>
                                  <div *ngIf="submitted && f.fComboEstatus.errors" style="color:red">
                                    <div *ngIf="f.fComboEstatus.errors.required">Requerido</div>
                                  </div>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>

                          <div class="row" *ngIf="!soloLectura">
                            <div class="col-10"></div>
                            <div class="col-2">
                              <button type="submit" class="btn btn-md" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">Guardar / Modificar TAG</button>
                            </div>
                        </div> 
                      </form>

                      <!-- SECCIÓN DE LOS PRECEDENTES -->
                      <div class="row" *ngIf= "existeTagId">
                        <div class="col-md-12">

                          <!-- LISTA DE PRECEDENTES ASIGNADOS -->
                          <div class="row" *ngIf= "existeTagId">
                            <div class="col-md-6">
                              <div class="md-form">  
                                <mat-label>Lista de procedentes asignados</mat-label>
                              </div>
                            </div>
                          </div>
                          <div class="row" *ngIf= "existeTagId" >
                            <div class="col-md-12">
                              <div class="md-form">
                                <table mdbTable>
                                  <thead>
                                    <tr>
                                      <th *ngFor="let head of cabeceraTagPrecedentes" scope="col">{{head}} </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr mdbTableCol *ngFor="let tagPrecedente of tagPrecedentes">
                                      <th scope="row"> {{tagPrecedente.tagPadre.tagId}} </th>
                                      <td>{{tagPrecedente.tagPadre.tag}}</td>
                                      <td>{{tagPrecedente.tagHijo.tag}}</td>
                                      <td>
                                        <a (click)="eliminarPrecedente(tagPrecedente)">
                                          <img src="assets/images/skins/ico_Borrar.png" alt="eliminar">
                                        </a>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                          <!-- LISTA DE PRECEDENTES ASIGNADOS -->

                          <!-- LISTA DE PRECEDENTES PARA ASIGNAR -->
                
                          <div class="row" *ngIf="isPrecedentes" >
                            <div class="col-md-6">
                              <div class="md-form">  
                                <mat-label>Actividades Procedentes</mat-label>
                              </div>
                            </div>
                          </div>
                          <div class="row" *ngIf="!soloLectura" >
                            <div class="col-md-6">
                              <div class="md-form">
                                <button type="button" class="btn" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}" (click)="mostrarPrecedentes()" >Mostrar Precedente</button>
                              </div>
                            </div>
                          </div>
                  
                          <!-- Agregar precedentes -->
                          <div class="row" >
                            <div class="col-md-12" *ngIf="tablaAgregarPrecedentes">
                              <div class="md-form">
                                <table mdbTable>
                                  <thead>
                                    <tr>
                                      <th *ngFor="let head of cabeceraTagPrecedentesAux" scope="col">{{head}} </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr mdbTableCol *ngFor="let actividadPrecedente of tagPrecedentesParaAsiganar">
                                      <th scope="row"> {{actividadPrecedente.tagId}} </th>
                                      <td>{{actividadPrecedente.tag}}</td>
                                      <td>{{actividadPrecedente.descripcion}}</td>
                                      <td>
                                          <mdb-checkbox (change)="agregarQuitarId( actividadPrecedente.tag )" ></mdb-checkbox>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                              <div class="row" *ngIf="tablaAgregarPrecedentes && !soloLectura">
                                <div class="col-10"></div>
                                <div class="col-2">
                                  <button type="button" class="btn" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}" (click)="agregarPrecedentes()" >Agregar Precedentes</button>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                
                    </div>
                  </div>
                  

                
            <!--  /CUERPO DEL COMPONENTE -->
            </div>
        </section>
    </div>
    <footer id="pie">
        Derechos Reservados &copy;   
    </footer>
</div>
          
