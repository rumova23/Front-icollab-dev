<div class="p-5">
  <!-- Titulo -->
  <div class=" row">
    <div class="col">
      <span class="agila-cda-titulo">{{getTitle()}}</span>
    </div>
  </div>
  <!--Botones-->
  <form [formGroup]="invoiceForm" (ngSubmit)="save(invoiceForm.value)">
    <div class="row mt-5 mb-5">
      <div class="col">
        <button type="submit" class="btn right" [disabled]="!invoiceForm.valid"
          [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">
          Guardar Factura
        </button>
      </div>
    </div>
    <!-- Inputs -->
    <ng-container *ngFor="let formControl of formControls">
      <div class="row">
        <div class="col dividerSection" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">
          <b>{{formControl.section}}</b>
        </div>
      </div>
      <div class="row">
        <ng-container *ngFor="let in of formControl.inputs">
          <ng-container [ngSwitch]="in.inputtype">
            <ng-container *ngSwitchCase="'text'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-form-field class="full-width">
                      <input matInput formControlName="{{in.formControlName}}" placeholder="{{in.label}}">
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!invoiceForm.controls[in.formControlName].valid 
                      && invoiceForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngSwitchCase="'time'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-form-field class="full-width">
                      <input type="time" matInput formControlName="{{in.formControlName}}" placeholder="{{in.label}}">
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!invoiceForm.controls[in.formControlName].valid 
                      && invoiceForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngSwitchCase="'select'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-form-field class="full-width">
                      <mat-label>{{in.label}}</mat-label>
                      <mat-select formControlName="{{in.formControlName}}"
                        (selectionChange)="onSelect($event.value, in)">
                        <mat-option *ngFor="let option of in.options" [value]="option">
                          {{option.description != null ? option.description: 
                            option.name != null ? option.name: option.tradename}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!invoiceForm.controls[in.formControlName].valid 
                      && invoiceForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngSwitchCase="'checkbox'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-checkbox class="active" color="primary" formControlName="{{in.formControlName}}">
                      <mat-label>{{in.label}}</mat-label>
                    </mat-checkbox>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!invoiceForm.controls[in.formControlName].valid 
                      && invoiceForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngSwitchCase="'textarea'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 12}}">
                    <mat-form-field class="full-width">
                      <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                        formControlName="{{in.formControlName}}" placeholder="{{in.label}}"></textarea>
                    </mat-form-field>
                    <div class="col-md-4">
                      <mat-error *ngIf="!invoiceForm.controls[in.formControlName].valid 
                              && invoiceForm.controls[in.formControlName].touched">
                        Requerido
                      </mat-error>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </ng-container>
      </div>
    </ng-container>
  </form>
    <!-- PRODUCTOS PARA LA FACTURA -->
    <form [formGroup]="productForm" (ngSubmit)="saveProduct(productForm.value)">
      <div class="row">
        <div class="col dividerSection" [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">
          <b> Productos </b>
        </div>
      </div>
      <div class="row">
        <ng-container *ngFor="let in of formControlsProduct">
          <ng-container [ngSwitch]="in.inputtype">
            <ng-container *ngSwitchCase="'text'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-form-field class="full-width">
                      <input matInput formControlName="{{in.formControlName}}" placeholder="{{in.label}}">
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!productForm.controls[in.formControlName].valid 
                                  && productForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngSwitchCase="'select'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-form-field class="full-width">
                      <mat-label>{{in.label}}</mat-label>
                      <mat-select formControlName="{{in.formControlName}}">
                        <mat-option *ngFor="let option of in.options" [value]="option">
                          {{option.description != null ? option.description: option.name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!productForm.controls[in.formControlName].valid 
                        && productForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngSwitchCase="'checkbox'">
              <div class="col-md-auto col-md-6 col-lg-4">
                <div class="row">
                  <div class="col-md-{{in.col || 8}}">
                    <mat-checkbox class="active" color="primary" formControlName="{{in.formControlName}}">
                      <mat-label>{{in.label}}</mat-label>
                    </mat-checkbox>
                  </div>
                  <div class="col-md-4">
                    <mat-error *ngIf="!productForm.controls[in.formControlName].valid 
                          && productForm.controls[in.formControlName].touched">
                      Requerido
                    </mat-error>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-container>
  
        </ng-container>
      </div>
      <div class="col">
        <button type="button" class="btn right" (click)="cancelProduct()"
          [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">
          Cancelar
        </button>
        <button type="submit" class="btn right" [disabled]="!productForm.valid"
          [ngClass]="{'blue': globalService.aguila,'orange': !globalService.aguila}">
          Agregar
        </button>
      </div>
    </form>
    <div class="table-container mat-elevation-z8">
      <table matSort mat-table [dataSource]="productsDatasource">
        <ng-container matColumnDef="product">
          <th mat-header-cell *matHeaderCellDef>Servicio </th>
          <td mat-cell *matCellDef="let element" class="p-2 border-none">
            {{element.product.name}}
          </td>
        </ng-container>
        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef>Cantidad </th>
          <td mat-cell *matCellDef="let element" class="p-2 border-none">
            {{element.quantity}}
          </td>
        </ng-container>

        <ng-container matColumnDef="unitValue">
          <th mat-header-cell *matHeaderCellDef>Valor Unitario </th>
          <td mat-cell *matCellDef="let element" class="p-2 border-none">
            {{element.unitValue}}
          </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Importe </th>
          <td mat-cell *matCellDef="let element" class="p-2 border-none">
            {{element.amount}}
          </td>
        </ng-container>

        <ng-container matColumnDef="percentageIva">
          <th mat-header-cell *matHeaderCellDef>Porcentaje Iva </th>
          <td mat-cell *matCellDef="let element" class="p-2 border-none">
            {{element.percentageIva}}
          </td>
        </ng-container>

        <ng-container matColumnDef="amountIva">
          <th mat-header-cell *matHeaderCellDef>Monto Iva </th>
          <td mat-cell *matCellDef="let element" class="p-2 border-none">
            {{element.amountIva}}
          </td>
        </ng-container>

        <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef> Editar </th>
            <td mat-cell *matCellDef="let element;" class="p-2 border-none">
              <a (click)="editProduct(element)" *ngIf="!entity.readOnly">
                <img src="assets/images/skins/ico_Editar.png" alt="Visualizar">
              </a>
            </td>
        </ng-container>
  
        <!-- Eliminar Column -->
        <ng-container matColumnDef="rm">
          <th mat-header-cell *matHeaderCellDef> Eliminar </th>
          <td mat-cell *matCellDef="let element; let i = index;" class="p-2 border-none">
            <i class="fas fa-trash-alt" (click)="deleteProduct(i)" *ngIf="!entity.readOnly"></i>
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="productsColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: productsColumns;"></tr>
      </table>
  
      <mat-paginator [pageSizeOptions]="[50,100,250,500]" showFirstLastButtons></mat-paginator>
    </div>
</div>