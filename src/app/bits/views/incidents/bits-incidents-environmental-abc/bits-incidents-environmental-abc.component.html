<div class="row">
	<mdb-breadcrumb customClass="white" class="w-100">
		<mdb-breadcrumb-item class="">
			<mdb-icon fas icon="cog"></mdb-icon>
		</mdb-breadcrumb-item>
		<mdb-breadcrumb-item>Configuración</mdb-breadcrumb-item>
		<mdb-breadcrumb-item>{{ "Incidentes" | translate }}</mdb-breadcrumb-item>
		<mdb-breadcrumb-item>{{ "Agregar Incidente" | translate }}</mdb-breadcrumb-item>
		<mdb-breadcrumb-item>{{ "Ambiental" | translate }}</mdb-breadcrumb-item>
		<mdb-breadcrumb-item class="active">{{ "Agregar" | translate }}</mdb-breadcrumb-item>
	</mdb-breadcrumb>
</div>

<form [formGroup]="formNew" (ngSubmit)="onFomrNew(formNew.value)">
	<div class="section">
		<div class="row">
			<div class="col">
				<p class="section_titulo_0">{{ "Agregar / Configuración de Incidente Ambiental" | translate }}</p>
				<p class="section_subtitulo_0">{{ "Descripción del Incidente" | translate }}</p>
			</div>
		</div>
		<hr>
		<br>

		<div class="row">
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="tag" 
					label="Tag" 
				></app-mat-input-text>
			</div>
		</div>
		<div class="row">
			<div class="col-12 col-xl-6">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="incidentType" 
					label="Tipo de Incidente" 
					maxLength="100"
				></app-mat-input-text>
			</div>
			<div class="col-12 col-xl-6">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="department" 
					label="Departamento" 
					maxLength="100"
				></app-mat-input-text>
			</div>
			<div class="col-12 col-xl-6">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="specificLocation" 
					label="Ubicación Especifica" 
					maxLength="100"
				></app-mat-input-text>
			</div>
			
			<div class="col-12 col-xl-4">
				<app-mat-input-datepicker
					[formGroup]="formNew" 
					controlName="incidentDate" 
					label="Fecha en que Ocurrio el Incidente" 
					(eventChange)="onChangeDateFechaOcurrioIncidente()"
				></app-mat-input-datepicker>
			</div>
			<div class="col-12 col-xl-1">
				<app-mat-select 
					[formGroup]="formTim"
					controlName="h1" 
					[options]="hours"
					(eventChange)="onChangeDateFechaOcurrioIncidente()"
					label="Hora"
				></app-mat-select>
			</div>
			<div class="col-12 col-xl-1">
				<app-mat-select 
					[formGroup]="formTim"
					controlName="m1" 
					[options]="hours"
					(eventChange)="onChangeDateFechaOcurrioIncidente()"
					label="Minuto"
				></app-mat-select>
			</div>
			<div class="col-12">
				<app-mat-input-textarea
					[formGroup]="formNew" 
					controlName="description" 
					label="Descripción del incidente" 
					maxLength="1000"
				></app-mat-input-textarea>
			</div>
		</div>
	</div>	
	<div class="section" *ngIf="cFNew.id.value != null">
		<div class="row">
			<div class="col-12 col-xl-2">
				<app-mat-input-checkbox
					[formGroup]="formNew" 
					controlName="AnalisisCausaRaizRCA" 
					label="Analisis de Causa Raiz (RCA)" 
				></app-mat-input-checkbox>
			</div>
			<div class="col-12 col-xl-4">
				<app-mat-input-datepicker
					[formGroup]="formNew" 
					controlName="FechaObjetivoEntregaRCA" 
					label="Fecha Objetivo Entrega RCA" 
				></app-mat-input-datepicker>
			</div>
			<div class="col-12 col-xl-1">
				<app-mat-select 
					[formGroup]="formTimFechaObjetivoEntregaRCA"
					controlName="h1" 
					[options]="hours"
					(eventChange)="onChangeDateTimeStart()"
					label="Hora"
				></app-mat-select>
			</div>
			<div class="col-12 col-xl-1">
				<app-mat-select 
					[formGroup]="formTimFechaObjetivoEntregaRCA"
					controlName="m1" 
					[options]="hours"
					(eventChange)="onChangeDateTimeStart()"
					label="Minuto"
				></app-mat-select>
			</div>
			<div class="col-12 col-xl-4">
				<app-mat-input-datepicker
					[formGroup]="formNew" 
					controlName="FechaHoraEntregaRCA" 
					label="Fecha y hora Entrega RCA" 
				></app-mat-input-datepicker>
			</div>
		</div>
		<div class="row my-5">
			<div class="col">
				<div class="media">
					<img src="assets/img/xlsx.png" style="width: 64px; height: 64px;">
					<div class="media-body">
						<p>nombre.xlsx</p>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="row" [formGroup]="formNew">
					
					<div class="col">
						Carga Archivo:<br />
						<app-file-upload formControlName="file" [progress]="progress"
						(change)="selectFile($event)"
						></app-file-upload>
						<mat-error *ngIf="!formNew.controls['file'].valid && formNew.controls['file'].touched">
							Requerido
						</mat-error>
					</div>
					<div class="col-12 col-lg-3">
						<div class="row mt-2">
							<div class="col">
								<app-btn-block-import (myClick)="uploadFile()" [disabled]="!formNew.valid || isReadOnly" ></app-btn-block-import>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-12 col-xl-2">
				<app-mat-input-checkbox
					[formGroup]="formNew" 
					controlName="Procede" 
					label="¿Procede?" 
				></app-mat-input-checkbox>
			</div>
		</div>
	</div>
	<div class="section" *ngIf="cFNew.id.value != null">
		<div class="row">
			<div class="col">
				<p class="section_titulo_0">{{ "Fuente" | translate }}</p>
				<p class="section_subtitulo_0"></p>
			</div>
		</div>
		<div class="row">
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="NombresApellidosUsuarioReporto" 
					label="Nombre(s)/Apellido(s) Usuario Reporto" 
				></app-mat-input-text>
			</div>
			<div class="col-12 col-xl-3">
				<app-mat-input-datepicker
					[formGroup]="formNew" 
					controlName="FechaHoraReporto" 
					label="Fecha y Hora Reporto" 
				></app-mat-input-datepicker>
			</div>
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="NombresApellidosUsuarioSuperviso" 
					label="Nombre(s)/Apellido(s) Usuario Superviso" 
				></app-mat-input-text>
			</div>
			<div class="col-12 col-xl-3">
				<app-mat-input-datepicker
					[formGroup]="formNew" 
					controlName="FechaHoraSuperviso" 
					label="Fecha y Hora Superviso" 
				></app-mat-input-datepicker>
			</div>
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="NombresApellidosUsuarioAproboRechazo" 
					label="Nombre(s)/Apellido(s) Usuario Aprobo/Rechazo" 
				></app-mat-input-text>
			</div>
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="FechaHoraAproboRechazo" 
					label="Fecha y Hora Aprobo/Rechazo" 
				></app-mat-input-text>
			</div>
		</div>

	</div>
	<div class="section" *ngIf="cFNew.id.value != null">
		<div class="row">
			<div class="col">
				<p class="section_titulo_0">{{ "Estatus del Evento" | translate }}</p>
				<p class="section_subtitulo_0"></p>
			</div>
		</div>
		<div class="row">
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="EstatusDelEvento" 
					label="Estatus del Evento" 
				></app-mat-input-text>
			</div>
			<div class="col-12 col-xl-3">
				<app-mat-input-text
					[formGroup]="formNew" 
					controlName="EstatusDeAprovacion" 
					label="Estatus de Aprovacion" 
				></app-mat-input-text>
			</div>
		</div>
	</div>
	<div class="section" *ngIf="cFNew.id.value != null">
		<div class="row">
			<div class="col">
				<p class="section_titulo_0">{{ "Observaciones" | translate }}</p>
				<p class="section_subtitulo_0"></p>
			</div>
		</div>
		<div class="row">
			<div class="col-12">
				<app-mat-input-textarea
					[formGroup]="formObs" 
					controlName="observation" 
					label="Observaciones" 
					maxLength="1000"
				></app-mat-input-textarea>
			</div>
		</div>
		
		<div class="row justify-content-end">
			<div class="col-12 col-lg-2">
				<app-btn-block-add (myClick)="BtnAddObservationsComments()" [disabled]="!formObs.valid || isReadOnly"></app-btn-block-add>
			</div>
		</div>
		<br>
		<div class="row">
			<div class="col">
				<app-mat-table 
					[data]="tableObservationsComments"
					[selection]="tableObservationsCommentsSelection"
					selectionLabel="Visible"
					[columnsDisplay]="tableColumnsDisplay"
					[columnsLabels]="tablaColumnsLabels"
					(clickEdit)="tableRowEdit($event)"
					(clickDelete)="tableRowDelete($event)"
				></app-mat-table>
			</div>
		</div>
	</div>
	<div class="section" *ngIf="cFNew.id.value != null">
		<div class="row">
			<div class="col">
				<p class="section_titulo_0">{{ "Soportes" | translate }}</p>
				<p class="section_subtitulo_0"></p>
			</div>
		</div>
		<div class="row my-5">
			<div class="col">
				<div class="media">
					<img src="assets/img/xlsx.png" style="width: 64px; height: 64px;">
					<div class="media-body">
						<p>nombre.xlsx</p>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="row" [formGroup]="fileUploadForm">
					
					<div class="col">
						Carga Archivo:<br />
						<app-file-upload formControlName="file" [progress]="progress"
						(change)="selectFile($event)"
						></app-file-upload>
						<mat-error *ngIf="!fileUploadForm.controls['file'].valid && fileUploadForm.controls['file'].touched">
							Requerido
						</mat-error>
					</div>
					<div class="col-12 col-lg-3">
						<div class="row mt-2">
							<div class="col">
								<app-btn-block-import (myClick)="uploadFile()" [disabled]="!fileUploadForm.valid" ></app-btn-block-import>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
	<div class="section" *ngIf="cFNew.id.value != null">
		<div class="row">
			<div class="col">
				<p class="section_titulo_0">{{ "Seguimiento" | translate }}</p>
				<p class="section_subtitulo_0"></p>
			</div>
		</div>
		<div class="row">
			<div class="col">
				<app-mat-table 
					[data]="tableSeguimiento"
					[columnsDisplay]="tableSeguimientoColumnsDisplay"
					[columnsLabels]="tablaSeguimientoColumnsLabels"
				></app-mat-table>
			</div>
		</div>
	</div>

	<div class="section">
		<div class="row">
			<div class="col-12 col-xl-4">
			</div>
			<div class="col-12 col-xl-8">
				<div class="row justify-content-end">
					<div class="col">
						<app-btn-block-back (myClick)="btnClickBack()"></app-btn-block-back>
					</div>
					<div class="col">
						<app-btn-block-save-update myType="submit" 
						[disabled]="disabledSubmit || isReadOnly || !formNew.valid">
						</app-btn-block-save-update>
					</div>
					<div class="col" *ngIf="!disabledBtnFinish">
						<app-btn-block-send (myClick)="btnSend()" 
						[disabled]="isReadOnly || !formNew.valid">
						</app-btn-block-send>
					</div>
					<div class="col" *ngIf="!disabledBtnFinish">
						<app-btn-block-finish (myClick)="btnFinish()" 
						[disabled]="disabledBtnFinish || isReadOnly || !formNew.valid">
						</app-btn-block-finish>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="section">
		<div class="row">
			<div class="col-12 col-xl-8">
			</div>
			<div class="col-12 col-xl-4">
				<div class="row justify-content-end">
					<div class="col-12 col-lg-6">
						<app-btn-block-reject (myClick)="btnChangeStatus('Evento Rechazado')"
							[disabled]="disabledToRefuse || isReadOnly || !formNew.valid"></app-btn-block-reject>
					</div>
					<div class="col-12 col-lg-6">
						<app-btn-block-acept (myClick)="btnChangeStatus('Evento Aprobado')"
							[disabled]="disabledToAccept || isReadOnly || !formNew.valid"></app-btn-block-acept>
					</div>
				</div>
			</div>
		</div>
	</div>
</form>